export const metadata = {
  title: "API Reference",
  description: "Endpoints, auth, and core request flows.",
  section: "Developer",
  order: 1,
};

# API Reference

This page summarizes the WebLingo Webhooks API surface used by the dashboard and integrations.

## Base URL + auth

- Base path: `/api`
- Most endpoints require `Authorization: Bearer <JWT>` signed with `WEBHOOK_SECRET`.
- Preview creation accepts `x-preview-token` as an alternative to bearer auth.
- Rate limits return `429` with a `Retry-After` header.

## Authentication

- `POST /auth/token` exchanges a Supabase access token for a Webhooks JWT.
- `GET /accounts/me` returns plan entitlements, feature flags, and quotas.
- `POST /accounts/claim` creates or links an account for the authenticated user.

## Supported languages

- `GET /meta/languages` returns supported language tags and direction (`ltr`/`rtl`).

## Site lifecycle

- `POST /sites` creates a site (source URL, source language, target languages, subdomain pattern).
- `GET /sites` lists sites; `GET /sites/{siteId}` fetches a single site.
- `PATCH /sites/{siteId}` updates configuration (targets, status, profiles, serving settings).
- `POST /sites/{siteId}/crawl` triggers a crawl (optional `force`).
- `POST /sites/{siteId}/translate` translates existing snapshots without recrawling.
- `GET /sites/{siteId}/translation-runs/{runId}` checks run status.
- `POST /sites/{siteId}/translation-runs/{runId}/cancel` or `/resume` controls in-flight runs.
- `GET /sites/{siteId}/pipeline/status/{pageVersionId}` inspects a single page version.

## Domains + serving

- `POST /sites/{siteId}/domains/{domain}/verify` validates ownership (TXT or test token).
- `POST /sites/{siteId}/domains/{domain}/provision` provisions Cloudflare for SaaS.
- `POST /sites/{siteId}/domains/{domain}/refresh` rechecks Cloudflare validation.
- `POST /sites/{siteId}/locales/{targetLang}/serve` toggles serving per locale.

## Translation controls

- `GET /sites/{siteId}/glossary` and `PUT /sites/{siteId}/glossary` manage glossary entries.
- `POST /sites/{siteId}/overrides` creates per-segment overrides.
- `POST /sites/{siteId}/slugs` updates translated slugs and can trigger a crawl.

## Observability + recovery

- `GET /sites/{siteId}/pages` lists discovered pages.
- `GET /sites/{siteId}/deployments` lists deployments per locale.
- `GET /sites/{siteId}/dlq` lists failed queue messages.
- `POST /sites/{siteId}/dlq/replay` replays DLQ messages.

## Previews

- `POST /previews` creates a Try Now preview.
- `GET /previews/{previewId}` checks preview status.

For the full schema, use the OpenAPI document generated by the webhooks worker.

Last verified against OpenAPI version `0.1.0` on 2026-01-27.

## Related docs

- [Getting Started](../getting-started)
- [Domain + CNAME Setup](../site-setup)
- [Translation Pipeline](../translation-pipeline)
