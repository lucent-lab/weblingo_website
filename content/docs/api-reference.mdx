export const metadata = {
  title: "API Reference",
  description: "Code-synced capabilities, auth requirements, and operation IDs.",
  section: "Developer",
  order: 1,
};

# API Reference

This page is user-facing and syncs to backend-generated artifacts. Use it for capability discovery,
then use backend OpenAPI for payload-level contracts.

## Base path + auth model

- Base path: `/api`
- Most operations require `Authorization: Bearer <dashboard-token>`.
- `POST /auth/token` mints dashboard tokens from a Supabase access token.
- Preview creation can use `x-preview-token`; preview status can use `x-preview-status-token`.
- Rate limits return `429` with a `Retry-After` header.

## Synced source artifacts

- `content/docs/_generated/backend-openapi.snapshot.json`
- `content/docs/_generated/backend-feature-catalog.snapshot.json`
- `content/docs/_generated/backend-playbooks.snapshot.md`
- `content/docs/_generated/backend-sync-manifest.json`

## Capability Index (User-Facing)

### API capabilities (`/api/*`)

| Capability                                      | operationId(s)                                                                                                                                                                              | Auth                                                               | Stability | Playbook                                                                          |
| ----------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------ | --------- | --------------------------------------------------------------------------------- |
| Account and language setup                      | `accounts.claim`, `accounts.me`, `meta.languages.list`                                                                                                                                      | Bearer JWT (none for `meta.languages.list`)                        | GA        | `Playbook: Account & Language Setup`                                              |
| Dashboard bootstrap and token minting           | `auth.token.mint`, `dashboard.bootstrap`                                                                                                                                                    | Bearer JWT                                                         | GA        | `Playbook 1: Dashboard Bootstrap and Site Setup`                                  |
| Agency customer portfolio                       | `agency.customers.list`, `agency.customers.create`                                                                                                                                          | Bearer JWT                                                         | GA        | `Playbook: Site Portfolio Management`                                             |
| Site portfolio management                       | `sites.list`, `sites.get`, `sites.update`, `sites.pages.list`                                                                                                                               | Bearer JWT                                                         | GA        | `Playbook: Site Portfolio Management`                                             |
| Site creation and deployment listing            | `sites.create`, `sites.deployments.list`                                                                                                                                                    | Bearer JWT                                                         | GA        | `Playbook 1: Dashboard Bootstrap and Site Setup`                                  |
| Domain verification and provisioning            | `sites.domains.verify`, `sites.domains.provision`, `sites.domains.refresh`                                                                                                                  | Bearer JWT                                                         | GA        | `Playbook 2: Domain Verification and Serving Activation`                          |
| Locale serving toggle and translation summaries | `sites.locales.serve`, `sites.locales.translationSummary.put`, `sites.translationSummaries.list`                                                                                            | Bearer JWT                                                         | GA/Beta   | `Playbook: Serving Access and Previews`, `Playbook 5: Previews and Notifications` |
| Crawl and translation lifecycle                 | `sites.crawl.trigger`, `sites.pages.crawl`, `sites.crawl_translate.trigger`, `sites.translate`, `sites.translationRuns.get`, `sites.translationRuns.cancel`, `sites.translationRuns.resume` | Bearer JWT                                                         | GA/Beta   | `Playbook 3: Crawl and Translate Lifecycle`                                       |
| Translation quality controls                    | `sites.glossary.get`, `sites.glossary.put`, `sites.overrides.create`, `sites.slugs.set`                                                                                                     | Bearer JWT                                                         | GA        | `Playbook 4: Translation Quality and Content Controls`                            |
| Previews and digest settings                    | `previews.create`, `previews.status`, `digests.subscription.upsert`                                                                                                                         | `x-preview-token` or Bearer JWT; `x-preview-status-token` (status) | Beta      | `Playbook 5: Previews and Notifications`                                          |

### Serving capabilities (non-`/api` HTTP)

| Capability               | Enabling operation / surface paths                                           | Auth | Stability | Playbook                                |
| ------------------------ | ---------------------------------------------------------------------------- | ---- | --------- | --------------------------------------- |
| Localized page serving   | `sites.locales.serve`, `GET /{path}` (`/{path}`)                             | None | GA        | `Playbook: Serving Access and Previews` |
| Preview artifact serving | `sites.locales.serve`, `GET /_preview/{previewId}` (`/_preview/{previewId}`) | None | Beta      | `Playbook: Serving Access and Previews` |

## Playbooks and schema details

- Workflow sequencing lives in `content/docs/_generated/backend-playbooks.snapshot.md`.
- Operation schemas/examples live in backend generated references:
- `docs/reference/API_REFERENCE.md`
- `docs/reference/openapi.json`

Last sync metadata is recorded in `content/docs/_generated/backend-sync-manifest.json`.

## Related docs

- [Getting Started](../getting-started)
- [Domain + CNAME Setup](../site-setup)
- [Translation Pipeline](../translation-pipeline)
